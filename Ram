<process name="EDE_Cloudwatch_Deliver_Logs">
  <rule name="FILE_CONDITION">
    <condition>number(/ProcessData/FILE_COUNT) &lt; 10</condition>
  </rule>
  <rule name="IS_DUPLICATE_TRUE">
    <condition>/ProcessData/IS_DUPLICATE = 'true'</condition>
  </rule>
  <rule name="IS_DUPLICATE_FALSE">
    <condition>/ProcessData/IS_DUPLICATE = 'false'</condition>
  </rule>

  <sequence name="MainFlow">
    <!-- Main process flow -->
    <operation name="File System Adapter - Collect">
      <!-- ... unchanged content ... -->
    </operation>

    <operation name="Timestamp Utility">
      <!-- ... unchanged content ... -->
    </operation>

    <assign name="Initialize File Count" to="FILE_COUNT">1</assign>

    <!-- Fixed FileCountCheck with direct child -->
    <choice name="FileCountCheck">
      <select>
        <case ref="FILE_CONDITION" activity="DoProcessing"/>
      </select>
      <!-- DoProcessing is now DIRECT CHILD of this choice -->
      <sequence name="DoProcessing">
        <assign name="Assign" to="PrimaryDocument" from="//*[starts-with(name(),'FSA_Document')][position()=/ProcessData/FILE_COUNT/text()]/@SCIOObjectID"/>
        <assign name="Assign" to="current_filename" from="/ProcessData/PrimaryDocument/text()"/>
        <operation name="Check Duplicate">
          <!-- ... unchanged content ... -->
        </operation>
        <assign name="Assign" to="IS_DUPLICATE" from="string(boolean(/ProcessData/result/Process/FILENAME))"/>
        
        <!-- Fixed DuplicateCheck with direct children -->
        <choice name="DuplicateCheck">
          <select>
            <case ref="IS_DUPLICATE_TRUE" activity="SkipInsert"/>
            <case ref="IS_DUPLICATE_FALSE" activity="PerformInsert"/>
          </select>
          <!-- Activities are now DIRECT CHILDREN of this choice -->
          <sequence name="SkipInsert">
            <assign name="Log" to="/ProcessData/status" from="'Skipped insert due to duplicate'"/>
          </sequence>
          <sequence name="PerformInsert">
            <operation name="Insert Log">
              <!-- ... unchanged content ... -->
            </operation>
          </sequence>
        </choice>
        
        <assign name="ChoiceExecuted" to="/ProcessData/ChoiceValidation" from="'ok'"/>
        <assign name="Assign" to="DOCUMENT" from="/ProcessData/PrimaryDocument/@SCIOObjectID"/>
        <operation name="File System Adapter - Extract">
          <!-- ... unchanged content ... -->
        </operation>
      </sequence>
    </choice>

    <operation name="DoNothing">
      <!-- ... unchanged content ... -->
    </operation>
  </sequence>
</process>
